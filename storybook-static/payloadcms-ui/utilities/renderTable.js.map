{"version":3,"file":"renderTable.js","names":["getTranslation","fieldAffectsData","fieldIsHiddenOrDisabled","flattenTopLevelFields","RenderServerComponent","buildColumnState","buildPolymorphicColumnState","filterFields","getInitialColumns","Pill","SelectAll","SelectRow","Table","renderFilters","fields","importMap","reduce","acc","field","admin","components","Filter","set","name","Component","Map","renderTable","clientCollectionConfig","clientConfig","collectionConfig","collections","columnPreferences","columns","columnsFromArgs","customCellProps","docs","enableRowSelections","i18n","payload","renderRowTypes","tableAppearance","useAsTitle","columnState","collection","config","find","each","slug","some","push","filter","column","accessor","defaultColumns","columnsToUse","unshift","active","disabled","hidden","Heading","t","renderedCells","map","doc","i","_jsx","relationTo","labels","singular","_","rowData","appearance","data"],"sources":["../../src/utilities/renderTable.tsx"],"sourcesContent":["import type {\n  ClientCollectionConfig,\n  ClientConfig,\n  ClientField,\n  CollectionConfig,\n  Field,\n  ImportMap,\n  ListPreferences,\n  PaginatedDocs,\n  Payload,\n  SanitizedCollectionConfig,\n} from 'payload'\n\nimport { getTranslation, type I18nClient } from '@payloadcms/translations'\nimport { fieldAffectsData, fieldIsHiddenOrDisabled, flattenTopLevelFields } from 'payload/shared'\n\n// eslint-disable-next-line payload/no-imports-from-exports-dir\nimport type { Column } from '../exports/client/index.js'\n\nimport { RenderServerComponent } from '../elements/RenderServerComponent/index.js'\nimport { buildColumnState } from '../providers/TableColumns/buildColumnState.js'\nimport { buildPolymorphicColumnState } from '../providers/TableColumns/buildPolymorphicColumnState.js'\nimport { filterFields } from '../providers/TableColumns/filterFields.js'\nimport { getInitialColumns } from '../providers/TableColumns/getInitialColumns.js'\n\n// eslint-disable-next-line payload/no-imports-from-exports-dir\nimport { Pill, SelectAll, SelectRow, Table } from '../exports/client/index.js'\n\nexport const renderFilters = (\n  fields: Field[],\n  importMap: ImportMap,\n): Map<string, React.ReactNode> =>\n  fields.reduce(\n    (acc, field) => {\n      if (fieldIsHiddenOrDisabled(field)) {\n        return acc\n      }\n\n      if ('name' in field && field.admin?.components?.Filter) {\n        acc.set(\n          field.name,\n          RenderServerComponent({\n            Component: field.admin.components?.Filter,\n            importMap,\n          }),\n        )\n      }\n\n      return acc\n    },\n    new Map() as Map<string, React.ReactNode>,\n  )\n\nexport const renderTable = ({\n  clientCollectionConfig,\n  clientConfig,\n  collectionConfig,\n  collections,\n  columnPreferences,\n  columns: columnsFromArgs,\n  customCellProps,\n  docs,\n  enableRowSelections,\n  i18n,\n  payload,\n  renderRowTypes,\n  tableAppearance,\n  useAsTitle,\n}: {\n  clientCollectionConfig?: ClientCollectionConfig\n  clientConfig?: ClientConfig\n  collectionConfig?: SanitizedCollectionConfig\n  collections?: string[]\n  columnPreferences: ListPreferences['columns']\n  columns?: ListPreferences['columns']\n  customCellProps?: Record<string, any>\n  docs: PaginatedDocs['docs']\n  drawerSlug?: string\n  enableRowSelections: boolean\n  i18n: I18nClient\n  payload: Payload\n  renderRowTypes?: boolean\n  tableAppearance?: 'condensed' | 'default'\n  useAsTitle: CollectionConfig['admin']['useAsTitle']\n}): {\n  columnState: Column[]\n  Table: React.ReactNode\n} => {\n  // Ensure that columns passed as args comply with the field config, i.e. `hidden`, `disableListColumn`, etc.\n\n  let columnState: Column[]\n\n  if (collections) {\n    const fields: ClientField[] = []\n    for (const collection of collections) {\n      const config = clientConfig.collections.find((each) => each.slug === collection)\n\n      for (const field of filterFields(config.fields)) {\n        if (fieldAffectsData(field)) {\n          if (fields.some((each) => fieldAffectsData(each) && each.name === field.name)) {\n            continue\n          }\n        }\n\n        fields.push(field)\n      }\n    }\n\n    const columns = columnsFromArgs\n      ? columnsFromArgs?.filter((column) =>\n          flattenTopLevelFields(fields, true)?.some(\n            (field) => 'name' in field && field.name === column.accessor,\n          ),\n        )\n      : getInitialColumns(fields, useAsTitle, [])\n\n    columnState = buildPolymorphicColumnState({\n      columnPreferences,\n      columns,\n      enableRowSelections,\n      fields,\n      i18n,\n      // sortColumnProps,\n      customCellProps,\n      docs,\n      payload,\n      useAsTitle,\n    })\n  } else {\n    const columns = columnsFromArgs\n      ? columnsFromArgs?.filter((column) =>\n          flattenTopLevelFields(clientCollectionConfig.fields, true)?.some(\n            (field) => 'name' in field && field.name === column.accessor,\n          ),\n        )\n      : getInitialColumns(\n          filterFields(clientCollectionConfig.fields),\n          useAsTitle,\n          clientCollectionConfig?.admin?.defaultColumns,\n        )\n\n    columnState = buildColumnState({\n      clientCollectionConfig,\n      collectionConfig,\n      columnPreferences,\n      columns,\n      enableRowSelections,\n      i18n,\n      // sortColumnProps,\n      customCellProps,\n      docs,\n      payload,\n      useAsTitle,\n    })\n  }\n\n  const columnsToUse = [...columnState]\n\n  if (renderRowTypes) {\n    columnsToUse.unshift({\n      accessor: 'collection',\n      active: true,\n      field: {\n        admin: {\n          disabled: true,\n        },\n        hidden: true,\n      },\n      Heading: i18n.t('version:type'),\n      renderedCells: docs.map((doc, i) => (\n        <Pill key={i}>\n          {getTranslation(\n            collections\n              ? payload.collections[doc.relationTo].config.labels.singular\n              : clientCollectionConfig.labels.singular,\n            i18n,\n          )}\n        </Pill>\n      )),\n    } as Column)\n  }\n\n  if (enableRowSelections) {\n    columnsToUse.unshift({\n      accessor: '_select',\n      active: true,\n      field: {\n        admin: {\n          disabled: true,\n        },\n        hidden: true,\n      },\n      Heading: <SelectAll />,\n      renderedCells: docs.map((_, i) => <SelectRow key={i} rowData={docs[i]} />),\n    } as Column)\n  }\n\n  return {\n    columnState,\n    // key is required since Next.js 15.2.0 to prevent React key error\n    Table: <Table appearance={tableAppearance} columns={columnsToUse} data={docs} key=\"table\" />,\n  }\n}\n"],"mappings":"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","ignoreList":[]}