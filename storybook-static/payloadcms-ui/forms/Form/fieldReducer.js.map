{"version":3,"file":"fieldReducer.js","names":["ObjectIdImport","dequal","deepCopyObjectSimple","deepCopyObjectSimpleWithoutReactComponents","flattenRows","separateRows","ObjectId","default","fieldReducer","state","action","type","blockType","path","rowIndex","rowIndexFromArgs","subFieldState","rows","length","withNewRow","newRow","id","value","toHexString","undefined","collapsed","isLoading","splice","initialValue","valid","remainingFields","siblingRows","newState","passesCondition","requiresRender","disableFormData","errorPaths","errors","forEach","message","fieldPath","errorMessage","segments","split","push","fieldErrorPath","parentPath","slice","join","Object","entries","reduce","acc","fieldState","fieldErrorPaths","errorACC","startsWith","changed","newErrorPaths","Array","isArray","includes","rowsMetadata","duplicateRowMetadata","duplicateRowState","key","keys","filter","endsWith","idState","isValid","moveFromIndex","moveToIndex","topLevelRows","copyOfMovingRow","rowsWithinField","copyOfMovingRow2","customComponents","RowLabels","copyOfMovingLabel","rowIndexArg","Math","max","min","optimize","newField","oldField","sanitize","field","values","updatedRows","formState"],"sources":["../../../src/forms/Form/fieldReducer.ts"],"sourcesContent":["'use client'\nimport type { FormField, FormState, Row } from 'payload'\n\nimport ObjectIdImport from 'bson-objectid'\nimport { dequal } from 'dequal/lite' // lite: no need for Map and Set support\nimport { deepCopyObjectSimple, deepCopyObjectSimpleWithoutReactComponents } from 'payload/shared'\n\nimport type { FieldAction } from './types.js'\n\nimport { flattenRows, separateRows } from './rows.js'\n\nconst ObjectId = (ObjectIdImport.default ||\n  ObjectIdImport) as unknown as typeof ObjectIdImport.default\n\n/**\n * Reducer which modifies the form field state (all the current data of the fields in the form). When called using dispatch, it will return a new state object.\n */\nexport function fieldReducer(state: FormState, action: FieldAction): FormState {\n  switch (action.type) {\n    case 'ADD_ROW': {\n      const { blockType, path, rowIndex: rowIndexFromArgs, subFieldState = {} } = action\n\n      const rowIndex =\n        typeof rowIndexFromArgs === 'number' ? rowIndexFromArgs : state[path]?.rows?.length || 0\n\n      const withNewRow = [...(state[path]?.rows || [])]\n\n      const newRow: Row = {\n        id: (subFieldState?.id?.value as string) || new ObjectId().toHexString(),\n        blockType: blockType || undefined,\n        collapsed: false,\n        isLoading: true,\n      }\n\n      withNewRow.splice(rowIndex, 0, newRow)\n\n      if (blockType) {\n        subFieldState.blockType = {\n          initialValue: blockType,\n          valid: true,\n          value: blockType,\n        }\n      }\n\n      // add new row to array _field state_\n      const { remainingFields, rows: siblingRows } = separateRows(path, state)\n\n      siblingRows.splice(rowIndex, 0, subFieldState)\n\n      const newState: FormState = {\n        ...remainingFields,\n        ...flattenRows(path, siblingRows),\n        [`${path}.${rowIndex}.id`]: {\n          initialValue: newRow.id,\n          passesCondition: true,\n          requiresRender: true,\n          valid: true,\n          value: newRow.id,\n        },\n        [path]: {\n          ...state[path],\n          disableFormData: true,\n          requiresRender: true,\n          rows: withNewRow,\n          value: siblingRows.length,\n        },\n      }\n\n      return newState\n    }\n\n    case 'ADD_SERVER_ERRORS': {\n      let newState = { ...state }\n\n      const errorPaths: { fieldErrorPath: string; parentPath: string }[] = []\n\n      action.errors.forEach(({ message, path: fieldPath }) => {\n        newState[fieldPath] = {\n          ...(newState[fieldPath] || {\n            initialValue: null,\n            value: null,\n          }),\n          errorMessage: message,\n          valid: false,\n        }\n\n        const segments = fieldPath.split('.')\n        if (segments.length > 1) {\n          errorPaths.push({\n            fieldErrorPath: fieldPath,\n            parentPath: segments.slice(0, segments.length - 1).join('.'),\n          })\n        }\n      })\n\n      newState = Object.entries(newState).reduce((acc, [path, fieldState]) => {\n        const fieldErrorPaths = errorPaths.reduce((errorACC, { fieldErrorPath, parentPath }) => {\n          if (parentPath.startsWith(path)) {\n            errorACC.push(fieldErrorPath)\n          }\n          return errorACC\n        }, [])\n\n        let changed = false\n\n        if (fieldErrorPaths.length > 0) {\n          const newErrorPaths = Array.isArray(fieldState.errorPaths) ? fieldState.errorPaths : []\n\n          fieldErrorPaths.forEach((fieldErrorPath) => {\n            if (!newErrorPaths.includes(fieldErrorPath)) {\n              newErrorPaths.push(fieldErrorPath)\n              changed = true\n            }\n          })\n\n          if (changed) {\n            acc[path] = {\n              ...fieldState,\n              errorPaths: newErrorPaths,\n            }\n          }\n        }\n\n        if (!changed) {\n          acc[path] = fieldState\n        }\n\n        return acc\n      }, {})\n\n      return newState\n    }\n\n    case 'DUPLICATE_ROW': {\n      const { path, rowIndex } = action\n      const { remainingFields, rows } = separateRows(path, state)\n      const rowsMetadata = [...(state[path].rows || [])]\n\n      const duplicateRowMetadata = deepCopyObjectSimple(rowsMetadata[rowIndex])\n      if (duplicateRowMetadata.id) {\n        duplicateRowMetadata.id = new ObjectId().toHexString()\n      }\n\n      const duplicateRowState = deepCopyObjectSimpleWithoutReactComponents(rows[rowIndex])\n      if (duplicateRowState.id) {\n        duplicateRowState.id.value = new ObjectId().toHexString()\n        duplicateRowState.id.initialValue = new ObjectId().toHexString()\n      }\n\n      for (const key of Object.keys(duplicateRowState).filter((key) => key.endsWith('.id'))) {\n        const idState = duplicateRowState[key]\n\n        if (idState && typeof idState.value === 'string' && ObjectId.isValid(idState.value)) {\n          duplicateRowState[key].value = new ObjectId().toHexString()\n          duplicateRowState[key].initialValue = new ObjectId().toHexString()\n        }\n      }\n\n      // If there are subfields\n      if (Object.keys(duplicateRowState).length > 0) {\n        // Add new object containing subfield names to unflattenedRows array\n        rows.splice(rowIndex + 1, 0, duplicateRowState)\n        rowsMetadata.splice(rowIndex + 1, 0, duplicateRowMetadata)\n      }\n\n      const newState = {\n        ...remainingFields,\n        ...flattenRows(path, rows),\n        [path]: {\n          ...state[path],\n          disableFormData: true,\n          requiresRender: true,\n          rows: rowsMetadata,\n          value: rows.length,\n        },\n      }\n\n      return newState\n    }\n\n    case 'MOVE_ROW': {\n      const { moveFromIndex, moveToIndex, path } = action\n\n      // Handle moving rows on the top-level, i.e. `array.0.text` -> `array.1.text`\n      const { remainingFields, rows: topLevelRows } = separateRows(path, state)\n      const copyOfMovingRow = topLevelRows[moveFromIndex]\n      topLevelRows.splice(moveFromIndex, 1)\n      topLevelRows.splice(moveToIndex, 0, copyOfMovingRow)\n\n      // modify array/block internal row state (i.e. collapsed, blockType)\n      const rowsWithinField = [...(state[path]?.rows || [])]\n      const copyOfMovingRow2 = { ...rowsWithinField[moveFromIndex] }\n      rowsWithinField.splice(moveFromIndex, 1)\n      rowsWithinField.splice(moveToIndex, 0, copyOfMovingRow2)\n\n      const newState = {\n        ...remainingFields,\n        ...flattenRows(path, topLevelRows),\n        [path]: {\n          ...state[path],\n          requiresRender: true,\n          rows: rowsWithinField,\n        },\n      }\n\n      // Do the same for custom components, i.e. `array.customComponents.RowLabels[0]` -> `array.customComponents.RowLabels[1]`\n      // Do this _after_ initializing `newState` to avoid adding the `customComponents` key to the state if it doesn't exist\n      if (newState[path]?.customComponents?.RowLabels) {\n        const customComponents = {\n          ...newState[path].customComponents,\n          RowLabels: [...newState[path].customComponents.RowLabels],\n        }\n\n        // Ensure the array grows if necessary\n        if (moveToIndex >= customComponents.RowLabels.length) {\n          customComponents.RowLabels.length = moveToIndex + 1\n        }\n\n        const copyOfMovingLabel = customComponents.RowLabels[moveFromIndex]\n\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        customComponents.RowLabels.splice(moveFromIndex, 1)\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        customComponents.RowLabels.splice(moveToIndex, 0, copyOfMovingLabel)\n\n        newState[path].customComponents = customComponents\n      }\n\n      return newState\n    }\n\n    case 'REMOVE': {\n      const newState = { ...state }\n      if (newState[action.path]) {\n        delete newState[action.path]\n      }\n      return newState\n    }\n\n    case 'REMOVE_ROW': {\n      const { path, rowIndex } = action\n      const { remainingFields, rows } = separateRows(path, state)\n      const rowsMetadata = [...(state[path]?.rows || [])]\n\n      rows.splice(rowIndex, 1)\n      rowsMetadata.splice(rowIndex, 1)\n\n      const newState: FormState = {\n        ...remainingFields,\n        [path]: {\n          ...state[path],\n          disableFormData: rows.length > 0,\n          requiresRender: true,\n          rows: rowsMetadata,\n          value: rows.length,\n        },\n        ...flattenRows(path, rows),\n      }\n\n      return newState\n    }\n\n    case 'REPLACE_ROW': {\n      const { blockType, path, rowIndex: rowIndexArg, subFieldState = {} } = action\n\n      const { remainingFields, rows: siblingRows } = separateRows(path, state)\n      const rowIndex = Math.max(0, Math.min(rowIndexArg, siblingRows?.length - 1 || 0))\n\n      const rowsMetadata = [...(state[path]?.rows || [])]\n      rowsMetadata[rowIndex] = {\n        id: new ObjectId().toHexString(),\n        blockType: blockType || undefined,\n        collapsed: false,\n      }\n\n      if (blockType) {\n        subFieldState.blockType = {\n          initialValue: blockType,\n          valid: true,\n          value: blockType,\n        }\n      }\n\n      // replace form _field state_\n      siblingRows[rowIndex] = subFieldState\n\n      const newState: FormState = {\n        ...remainingFields,\n        ...flattenRows(path, siblingRows),\n        [path]: {\n          ...state[path],\n          disableFormData: true,\n          rows: rowsMetadata,\n          value: siblingRows.length,\n        },\n      }\n\n      return newState\n    }\n\n    case 'REPLACE_STATE': {\n      if (action.optimize !== false) {\n        // Only update fields that have changed\n        // by comparing old value / initialValue to new\n        // ..\n        // This is a performance enhancement for saving\n        // large documents with hundreds of fields\n        const newState: FormState = {}\n\n        for (const [path, newField] of Object.entries(action.state)) {\n          const oldField = state[path]\n\n          if (newField.valid !== false) {\n            newField.valid = true\n          }\n          if (newField.passesCondition !== false) {\n            newField.passesCondition = true\n          }\n\n          if (!dequal(oldField, newField)) {\n            newState[path] = newField\n          } else if (oldField) {\n            newState[path] = oldField\n          }\n        }\n\n        return newState\n      }\n\n      //TODO: Remove this in 4.0 - this is a temporary fix to prevent a breaking change\n      if (action.sanitize) {\n        for (const field of Object.values(action.state)) {\n          if (field.valid !== false) {\n            field.valid = true\n          }\n          if (field.passesCondition !== false) {\n            field.passesCondition = true\n          }\n        }\n      }\n      // If we're not optimizing, just set the state to the new state\n      return action.state\n    }\n\n    case 'SET_ALL_ROWS_COLLAPSED': {\n      const { path, updatedRows } = action\n\n      return {\n        ...state,\n        [path]: {\n          ...state[path],\n          rows: updatedRows,\n        },\n      }\n    }\n\n    case 'SET_ROW_COLLAPSED': {\n      const { path, updatedRows } = action\n\n      const newState = {\n        ...state,\n        [path]: {\n          ...state[path],\n          rows: updatedRows,\n        },\n      }\n\n      return newState\n    }\n\n    case 'UPDATE': {\n      const newField = Object.entries(action).reduce(\n        (field, [key, value]) => {\n          if (\n            [\n              'disableFormData',\n              'errorMessage',\n              'initialValue',\n              'rows',\n              'valid',\n              'validate',\n              'value',\n            ].includes(key)\n          ) {\n            return {\n              ...field,\n              [key]: value,\n            }\n          }\n\n          return field\n        },\n        state?.[action.path] || ({} as FormField),\n      )\n\n      const newState = {\n        ...state,\n        [action.path]: newField,\n      }\n\n      return newState\n    }\n\n    case 'UPDATE_MANY': {\n      const newState = { ...state }\n\n      Object.entries(action.formState).forEach(([path, field]) => {\n        newState[path] = field\n      })\n\n      return newState\n    }\n\n    default: {\n      return state\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}