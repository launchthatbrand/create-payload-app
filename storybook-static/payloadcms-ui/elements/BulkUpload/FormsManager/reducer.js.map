{"version":3,"file":"reducer.js","names":["formsManagementReducer","state","action","type","newForms","i","files","length","errorCount","formState","initialState","file","initialValue","valid","value","activeIndex","forms","remainingFormStates","removedForm","splice","index","affectedByShift","nextIndex","boundedActiveIndex","Math","min","totalErrorCount","count","reduce","acc","form","updatedForms"],"sources":["../../../../src/elements/BulkUpload/FormsManager/reducer.ts"],"sourcesContent":["import type { FormState } from 'payload'\n\nexport type State = {\n  activeIndex: number\n  forms: {\n    errorCount: number\n    formState: FormState\n  }[]\n  totalErrorCount: number\n}\n\ntype Action =\n  | {\n      count: number\n      index: number\n      type: 'UPDATE_ERROR_COUNT'\n    }\n  | {\n      errorCount: number\n      formState: FormState\n      index: number\n      type: 'UPDATE_FORM'\n      updatedFields?: Record<string, unknown>\n    }\n  | {\n      files: FileList\n      initialState: FormState | null\n      type: 'ADD_FORMS'\n    }\n  | {\n      index: number\n      type: 'REMOVE_FORM'\n    }\n  | {\n      index: number\n      type: 'SET_ACTIVE_INDEX'\n    }\n  | {\n      state: Partial<State>\n      type: 'REPLACE'\n    }\n\nexport function formsManagementReducer(state: State, action: Action): State {\n  switch (action.type) {\n    case 'ADD_FORMS': {\n      const newForms: State['forms'] = []\n      for (let i = 0; i < action.files.length; i++) {\n        newForms[i] = {\n          errorCount: 0,\n          formState: {\n            ...(action.initialState || {}),\n            file: {\n              initialValue: action.files[i],\n              valid: true,\n              value: action.files[i],\n            },\n          },\n        }\n      }\n\n      return {\n        ...state,\n        activeIndex: 0,\n        forms: [...newForms, ...state.forms],\n      }\n    }\n    case 'REMOVE_FORM': {\n      const remainingFormStates = [...state.forms]\n      const [removedForm] = remainingFormStates.splice(action.index, 1)\n\n      const affectedByShift = state.activeIndex >= action.index\n      const nextIndex =\n        state.activeIndex === action.index\n          ? action.index\n          : affectedByShift\n            ? state.activeIndex - 1\n            : state.activeIndex\n      const boundedActiveIndex = Math.min(remainingFormStates.length - 1, nextIndex)\n\n      return {\n        ...state,\n        activeIndex: affectedByShift ? boundedActiveIndex : state.activeIndex,\n        forms: remainingFormStates,\n        totalErrorCount: state.totalErrorCount - removedForm.errorCount,\n      }\n    }\n    case 'REPLACE': {\n      return {\n        ...state,\n        ...action.state,\n      }\n    }\n    case 'SET_ACTIVE_INDEX': {\n      return {\n        ...state,\n        activeIndex: action.index,\n      }\n    }\n    case 'UPDATE_ERROR_COUNT': {\n      const forms = [...state.forms]\n      forms[action.index].errorCount = action.count\n\n      return {\n        ...state,\n        forms,\n        totalErrorCount: state.forms.reduce((acc, form) => acc + form.errorCount, 0),\n      }\n    }\n    case 'UPDATE_FORM': {\n      const updatedForms = [...state.forms]\n      updatedForms[action.index].errorCount = action.errorCount\n\n      // Merge the existing formState with the new formState\n      updatedForms[action.index] = {\n        ...updatedForms[action.index],\n        formState: {\n          ...updatedForms[action.index].formState,\n          ...action.formState,\n        },\n      }\n\n      return {\n        ...state,\n        forms: updatedForms,\n        totalErrorCount: state.forms.reduce((acc, form) => acc + form.errorCount, 0),\n      }\n    }\n    default: {\n      return state\n    }\n  }\n}\n"],"mappings":"AA0CA,OAAO,SAASA,uBAAuBC,KAAY,EAAEC,MAAc;EACjE,QAAQA,MAAA,CAAOC,IAAI;IACjB,KAAK;MAAa;QAChB,MAAMC,QAAA,GAA2B,EAAE;QACnC,KAAK,IAAIC,CAAA,GAAI,GAAGA,CAAA,GAAIH,MAAA,CAAOI,KAAK,CAACC,MAAM,EAAEF,CAAA,IAAK;UAC5CD,QAAQ,CAACC,CAAA,CAAE,GAAG;YACZG,UAAA,EAAY;YACZC,SAAA,EAAW;cACT,IAAIP,MAAA,CAAOQ,YAAY,IAAI,CAAC,CAAC;cAC7BC,IAAA,EAAM;gBACJC,YAAA,EAAcV,MAAA,CAAOI,KAAK,CAACD,CAAA,CAAE;gBAC7BQ,KAAA,EAAO;gBACPC,KAAA,EAAOZ,MAAA,CAAOI,KAAK,CAACD,CAAA;cACtB;YACF;UACF;QACF;QAEA,OAAO;UACL,GAAGJ,KAAK;UACRc,WAAA,EAAa;UACbC,KAAA,EAAO,C,GAAIZ,QAAA,E,GAAaH,KAAA,CAAMe,KAAK;QACrC;MACF;IACA,KAAK;MAAe;QAClB,MAAMC,mBAAA,GAAsB,C,GAAIhB,KAAA,CAAMe,KAAK,CAAC;QAC5C,MAAM,CAACE,WAAA,CAAY,GAAGD,mBAAA,CAAoBE,MAAM,CAACjB,MAAA,CAAOkB,KAAK,EAAE;QAE/D,MAAMC,eAAA,GAAkBpB,KAAA,CAAMc,WAAW,IAAIb,MAAA,CAAOkB,KAAK;QACzD,MAAME,SAAA,GACJrB,KAAA,CAAMc,WAAW,KAAKb,MAAA,CAAOkB,KAAK,GAC9BlB,MAAA,CAAOkB,KAAK,GACZC,eAAA,GACEpB,KAAA,CAAMc,WAAW,GAAG,IACpBd,KAAA,CAAMc,WAAW;QACzB,MAAMQ,kBAAA,GAAqBC,IAAA,CAAKC,GAAG,CAACR,mBAAA,CAAoBV,MAAM,GAAG,GAAGe,SAAA;QAEpE,OAAO;UACL,GAAGrB,KAAK;UACRc,WAAA,EAAaM,eAAA,GAAkBE,kBAAA,GAAqBtB,KAAA,CAAMc,WAAW;UACrEC,KAAA,EAAOC,mBAAA;UACPS,eAAA,EAAiBzB,KAAA,CAAMyB,eAAe,GAAGR,WAAA,CAAYV;QACvD;MACF;IACA,KAAK;MAAW;QACd,OAAO;UACL,GAAGP,KAAK;UACR,GAAGC,MAAA,CAAOD;QACZ;MACF;IACA,KAAK;MAAoB;QACvB,OAAO;UACL,GAAGA,KAAK;UACRc,WAAA,EAAab,MAAA,CAAOkB;QACtB;MACF;IACA,KAAK;MAAsB;QACzB,MAAMJ,KAAA,GAAQ,C,GAAIf,KAAA,CAAMe,KAAK,CAAC;QAC9BA,KAAK,CAACd,MAAA,CAAOkB,KAAK,CAAC,CAACZ,UAAU,GAAGN,MAAA,CAAOyB,KAAK;QAE7C,OAAO;UACL,GAAG1B,KAAK;UACRe,KAAA;UACAU,eAAA,EAAiBzB,KAAA,CAAMe,KAAK,CAACY,MAAM,CAAC,CAACC,GAAA,EAAKC,IAAA,KAASD,GAAA,GAAMC,IAAA,CAAKtB,UAAU,EAAE;QAC5E;MACF;IACA,KAAK;MAAe;QAClB,MAAMuB,YAAA,GAAe,C,GAAI9B,KAAA,CAAMe,KAAK,CAAC;QACrCe,YAAY,CAAC7B,MAAA,CAAOkB,KAAK,CAAC,CAACZ,UAAU,GAAGN,MAAA,CAAOM,UAAU;QAEzD;QACAuB,YAAY,CAAC7B,MAAA,CAAOkB,KAAK,CAAC,GAAG;UAC3B,GAAGW,YAAY,CAAC7B,MAAA,CAAOkB,KAAK,CAAC;UAC7BX,SAAA,EAAW;YACT,GAAGsB,YAAY,CAAC7B,MAAA,CAAOkB,KAAK,CAAC,CAACX,SAAS;YACvC,GAAGP,MAAA,CAAOO;UACZ;QACF;QAEA,OAAO;UACL,GAAGR,KAAK;UACRe,KAAA,EAAOe,YAAA;UACPL,eAAA,EAAiBzB,KAAA,CAAMe,KAAK,CAACY,MAAM,CAAC,CAACC,GAAA,EAAKC,IAAA,KAASD,GAAA,GAAMC,IAAA,CAAKtB,UAAU,EAAE;QAC5E;MACF;IACA;MAAS;QACP,OAAOP,KAAA;MACT;EACF;AACF","ignoreList":[]}