{"version":3,"file":"BlockRow.js","names":["c","_c","getTranslation","React","Collapsible","ErrorPill","Pill","ShimmerEffect","useFormSubmitted","RenderFields","RowLabel","useThrottledValue","useTranslation","RowActions","SectionTitle","baseClass","BlockRow","t0","$","addRow","attributes","block","blocks","duplicateRow","errorCount","fields","hasMaxRows","isLoading","isLoadingFromProps","isSortable","Label","labels","listeners","moveRow","parentPath","path","permissions","readOnly","removeRow","row","rowCount","rowIndex","schemaPath","setCollapse","setNodeRef","transform","i18n","hasSubmitted","fieldHasErrors","showBlockName","admin","disableBlockName","t1","t2","filter","Boolean","classNames","join","blockPermissions","permissionsBlockSpecific","slug","t3","split","t4","blockType","collapsed","id","t5","_jsx","ref","style","children","actions","className","collapsibleStyle","dragHandleProps","undefined","header","height","width","_jsxs","CustomComponent","label","_Fragment","String","padStart","pillStyle","singular","count","withMessage","onToggle","margins","parentIndexPath","parentSchemaPath"],"sources":["../../../src/fields/Blocks/BlockRow.tsx"],"sourcesContent":["'use client'\nimport type { ClientBlock, ClientField, Labels, Row, SanitizedFieldPermissions } from 'payload'\n\nimport { getTranslation } from '@payloadcms/translations'\nimport React from 'react'\n\nimport type { UseDraggableSortableReturn } from '../../elements/DraggableSortable/useDraggableSortable/types.js'\nimport type { RenderFieldsProps } from '../../forms/RenderFields/types.js'\n\nimport { Collapsible } from '../../elements/Collapsible/index.js'\nimport { ErrorPill } from '../../elements/ErrorPill/index.js'\nimport { Pill } from '../../elements/Pill/index.js'\nimport { ShimmerEffect } from '../../elements/ShimmerEffect/index.js'\nimport { useFormSubmitted } from '../../forms/Form/context.js'\nimport { RenderFields } from '../../forms/RenderFields/index.js'\nimport { RowLabel } from '../../forms/RowLabel/index.js'\nimport { useThrottledValue } from '../../hooks/useThrottledValue.js'\nimport { useTranslation } from '../../providers/Translation/index.js'\nimport { RowActions } from './RowActions.js'\nimport { SectionTitle } from './SectionTitle/index.js'\n\nconst baseClass = 'blocks-field'\n\ntype BlocksFieldProps = {\n  addRow: (rowIndex: number, blockType: string) => Promise<void> | void\n  block: ClientBlock\n  blocks: (ClientBlock | string)[] | ClientBlock[]\n  duplicateRow: (rowIndex: number) => void\n  errorCount: number\n  fields: ClientField[]\n  hasMaxRows?: boolean\n  isLoading?: boolean\n  isSortable?: boolean\n  Label?: React.ReactNode\n  labels: Labels\n  moveRow: (fromIndex: number, toIndex: number) => void\n  parentPath: string\n  path: string\n  permissions: SanitizedFieldPermissions\n  readOnly: boolean\n  removeRow: (rowIndex: number) => void\n  row: Row\n  rowCount: number\n  rowIndex: number\n  schemaPath: string\n  setCollapse: (id: string, collapsed: boolean) => void\n} & UseDraggableSortableReturn\n\nexport const BlockRow: React.FC<BlocksFieldProps> = ({\n  addRow,\n  attributes,\n  block,\n  blocks,\n  duplicateRow,\n  errorCount,\n  fields,\n  hasMaxRows,\n  isLoading: isLoadingFromProps,\n  isSortable,\n  Label,\n  labels,\n  listeners,\n  moveRow,\n  parentPath,\n  path,\n  permissions,\n  readOnly,\n  removeRow,\n  row,\n  rowCount,\n  rowIndex,\n  schemaPath,\n  setCollapse,\n  setNodeRef,\n  transform,\n}) => {\n  const isLoading = useThrottledValue(isLoadingFromProps, 500)\n\n  const { i18n } = useTranslation()\n  const hasSubmitted = useFormSubmitted()\n\n  const fieldHasErrors = hasSubmitted && errorCount > 0\n\n  const showBlockName = !block.admin?.disableBlockName\n\n  const classNames = [\n    `${baseClass}__row`,\n    fieldHasErrors ? `${baseClass}__row--has-errors` : `${baseClass}__row--no-errors`,\n  ]\n    .filter(Boolean)\n    .join(' ')\n\n  let blockPermissions: RenderFieldsProps['permissions'] = undefined\n\n  if (permissions === true) {\n    blockPermissions = true\n  } else {\n    const permissionsBlockSpecific = permissions?.blocks?.[block.slug]\n    if (permissionsBlockSpecific === true) {\n      blockPermissions = true\n    } else {\n      blockPermissions = permissionsBlockSpecific?.fields\n    }\n  }\n\n  return (\n    <div\n      id={`${parentPath?.split('.').join('-')}-row-${rowIndex}`}\n      key={`${parentPath}-row-${rowIndex}`}\n      ref={setNodeRef}\n      style={{\n        transform,\n      }}\n    >\n      <Collapsible\n        actions={\n          !readOnly ? (\n            <RowActions\n              addRow={addRow}\n              blocks={blocks}\n              blockType={row.blockType}\n              duplicateRow={duplicateRow}\n              fields={block.fields}\n              hasMaxRows={hasMaxRows}\n              isSortable={isSortable}\n              labels={labels}\n              moveRow={moveRow}\n              removeRow={removeRow}\n              rowCount={rowCount}\n              rowIndex={rowIndex}\n            />\n          ) : undefined\n        }\n        className={classNames}\n        collapsibleStyle={fieldHasErrors ? 'error' : 'default'}\n        dragHandleProps={\n          isSortable\n            ? {\n                id: row.id,\n                attributes,\n                listeners,\n              }\n            : undefined\n        }\n        header={\n          isLoading ? (\n            <ShimmerEffect height=\"1rem\" width=\"8rem\" />\n          ) : (\n            <div className={`${baseClass}__block-header`}>\n              <RowLabel\n                CustomComponent={Label}\n                label={\n                  <>\n                    <span className={`${baseClass}__block-number`}>\n                      {String(rowIndex + 1).padStart(2, '0')}\n                    </span>\n                    <Pill\n                      className={`${baseClass}__block-pill ${baseClass}__block-pill-${row.blockType}`}\n                      pillStyle=\"white\"\n                    >\n                      {getTranslation(block.labels.singular, i18n)}\n                    </Pill>\n                    {showBlockName && (\n                      <SectionTitle path={`${path}.blockName`} readOnly={readOnly} />\n                    )}\n                  </>\n                }\n                path={path}\n                rowNumber={rowIndex}\n              />\n              {fieldHasErrors && <ErrorPill count={errorCount} i18n={i18n} withMessage />}\n            </div>\n          )\n        }\n        isCollapsed={row.collapsed}\n        key={row.id}\n        onToggle={(collapsed) => setCollapse(row.id, collapsed)}\n      >\n        {isLoading ? (\n          <ShimmerEffect />\n        ) : (\n          <RenderFields\n            className={`${baseClass}__fields`}\n            fields={fields}\n            margins=\"small\"\n            parentIndexPath=\"\"\n            parentPath={path}\n            parentSchemaPath={schemaPath}\n            permissions={blockPermissions}\n            readOnly={readOnly}\n          />\n        )}\n      </Collapsible>\n    </div>\n  )\n}\n"],"mappings":"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","ignoreList":[]}